<div class="session-container">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading flashcards...</p>
    </div>
  } @else if (error()) {
    <!-- Error State -->
    <div class="error-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h2>Error</h2>
      <p>{{ error() }}</p>
      <button class="btn btn-primary" (click)="goToDeck()">Back to Decks</button>
    </div>
  } @else if (isCompleted()) {
    <!-- Completion Screen -->
    <div class="completion-screen">
      <div class="completion-header">
        <div class="completion-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h1>Session Complete!</h1>
        <p class="completion-subtitle">{{ deck()?.title }}</p>
      </div>

      <div class="completion-stats">
        <app-stat-card [config]="{
          icon: 'svg',
          iconContent: '<polyline points=\'20 6 9 17 4 12\'/>',
          value: correctAnswers(),
          label: 'Known',
          variant: 'success'
        }" />

        <app-stat-card [config]="{
          icon: 'svg',
          iconContent: '<line x1=\'18\' y1=\'6\' x2=\'6\' y2=\'18\'/><line x1=\'6\' y1=\'6\' x2=\'18\' y2=\'18\'/>',
          value: incorrectAnswers(),
          label: 'Unknown',
          variant: 'error'
        }" />

        <app-stat-card [config]="{
          icon: 'svg',
          iconContent: '<rect x=\'2\' y=\'7\' width=\'20\' height=\'14\' rx=\'2\'/><path d=\'M2 11h20\'/>',
          value: totalCards(),
          label: 'Total Cards',
          variant: 'total'
        }" />

        <app-stat-card [config]="{
          icon: 'svg',
          iconContent: '<path d=\'M12 2v20M2 12h20\'/>',
          value: getSuccessRate() + '%',
          label: 'Success Rate'
        }" />
      </div>

      <div class="completion-actions">
        <button class="btn btn-primary" (click)="restartSession()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"/>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
          </svg>
          Study Again
        </button>
        <button class="btn btn-secondary" (click)="editDeck()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Edit Deck
        </button>
        <button class="btn btn-secondary" (click)="goToDeck()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Decks
        </button>
      </div>
    </div>
  } @else {
    <!-- Active Session -->
    <div class="session-header">
      <div class="header-left">
        <button class="back-button" (click)="goToDeck()" aria-label="Back to decks">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <div class="deck-info">
          <h2>{{ deck()?.title }}</h2>
          <p class="card-counter">Card {{ currentCardIndex() + 1 }} of {{ totalCards() }}</p>
        </div>
      </div>

      <div class="header-right">
        @if (currentCard() && currentCard()!.progress) {
          <div class="current-level" [style.background]="getLevelColor(currentCard()!.progress!.level)">
            Level {{ currentCard()!.progress!.level }}
          </div>
        }
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progress()"></div>
      </div>
      <span class="progress-text">{{ progress() }}% Complete</span>
    </div>

    <!-- Flashcard -->
    @if (currentCard()) {
      <div class="flashcard-container">
        <app-flashcard
          [question]="currentCard()!.question"
          (answerSubmit)="handleAnswer($event)">
        </app-flashcard>
      </div>
    }

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint">
      <p>
        <kbd>Space</kbd> or <kbd>Enter</kbd> to flip •
        <kbd>→</kbd> or <kbd>Y</kbd> for known •
        <kbd>←</kbd> or <kbd>N</kbd> for unknown
      </p>
    </div>

    <!-- Session Stats -->
    <div class="session-stats">
      <div class="stat-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
        <span>{{ correctAnswers() }} known</span>
      </div>
      <div class="stat-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        <span>{{ incorrectAnswers() }} unknown</span>
      </div>
      <div class="stat-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="7" width="20" height="14" rx="2"/>
        </svg>
        <span>{{ cardsRemaining() }} remaining</span>
      </div>
    </div>
  }
</div>
