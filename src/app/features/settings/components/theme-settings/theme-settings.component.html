<div class="theme-settings">
  <div class="current-row">
    <div class="current-preview" [style.background]="previewGradient(activeTheme())"></div>
    <div class="current-info">
      <strong>{{ 'settings.page.theme.current' | translate }}</strong>
      <div class="current-name">
        @if (activeTheme().labelKey) {
          {{ activeTheme().labelKey! | translate }}
        } @else {
          {{ activeTheme().name }}
        }
      </div>
    </div>
    <button class="btn btn-secondary btn-small" (click)="resetToDefault()">
      {{ 'settings.page.theme.reset' | translate }}
    </button>
  </div>

  <div class="theme-block">
    <div class="block-header">
      <h3>{{ 'settings.page.theme.presets.title' | translate }}</h3>
      <p>{{ 'settings.page.theme.presets.subtitle' | translate }}</p>
    </div>

    <div class="theme-grid">
      @for (theme of presets(); track theme.id) {
        <button
          class="theme-card"
          type="button"
          [class.active]="activeThemeId() === theme.id"
          (click)="selectTheme(theme.id)">
          <div class="swatch" [style.background]="previewGradient(theme)"></div>
          <div class="meta">
            <div class="name">
              @if (theme.labelKey) {
                {{ theme.labelKey | translate }}
              } @else {
                {{ theme.name }}
              }
            </div>
            <div class="badge">{{ 'settings.page.theme.badges.preset' | translate }}</div>
          </div>
        </button>
      }
    </div>
  </div>

  <div class="theme-block">
    <div class="block-header block-header-row">
      <div>
        <h3>{{ 'settings.page.theme.custom.title' | translate }}</h3>
        <p>{{ 'settings.page.theme.custom.subtitle' | translate }}</p>
      </div>

      <button class="btn btn-primary btn-small" type="button" (click)="createTheme()">
        {{ 'settings.page.theme.createTheme' | translate }}
      </button>
    </div>

    @if (storedThemes().length === 0) {
      <div class="empty">
        {{ 'settings.page.theme.custom.empty' | translate }}
      </div>
    } @else {
      <div class="theme-grid">
        @for (theme of storedThemes(); track theme.id) {
          <div
            class="theme-card"
            role="button"
            tabindex="0"
            [class.active]="activeThemeId() === theme.id"
            (click)="selectTheme(theme.id)"
            (keydown.enter)="selectTheme(theme.id)"
            (keydown.space)="selectTheme(theme.id); $event.preventDefault()">
            <div class="swatch" [style.background]="previewGradientForStoredTheme(theme)"></div>
            <div class="meta">
              <div class="name">{{ theme.name }}</div>
              <div class="badge-row">
                <div class="badge">
                  @if (theme.source === 'community') {
                    {{ 'settings.page.theme.badges.marketplace' | translate }}
                  } @else {
                    {{ 'settings.page.theme.badges.custom' | translate }}
                  }
                </div>
                @if (theme.source === 'custom' && visibilityLabelKey(theme.id)) {
                  <div class="badge">{{ visibilityLabelKey(theme.id)! | translate }}</div>
                }
              </div>
            </div>

            <div class="card-actions">
              @if (theme.source === 'custom') {
                <button class="icon-btn" type="button" (click)="editTheme(theme, $event)" [title]="'common.edit' | translate">
                  âœŽ
                </button>
              } @else if (theme.source === 'community') {
                <button
                  class="icon-btn danger"
                  type="button"
                  (click)="removeInstalledTheme(theme, $event)"
                  [title]="'settings.page.theme.marketplace.uninstall' | translate">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                    <path d="M10 11v6"/>
                    <path d="M14 11v6"/>
                    <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
                  </svg>
                </button>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
