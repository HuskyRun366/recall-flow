<div class="quiz-editor">
  <!-- Header -->
  <div class="editor-header">
    <div class="header-left">
      <p class="eyebrow">
        {{ 'quiz.editor.eyebrow' | translate }}
        @if (unsavedChanges()) {
          <span> â€¢ {{ 'common.unsaved' | translate }}</span>
        }
      </p>
      <h1>{{ quiz()?.title || ('quiz.newQuiz' | translate) }}{{ unsavedChanges() ? ' *' : '' }}</h1>
      <p class="subtitle">
        {{ editorMode() === 'toon' ? ('quiz.editor.subtitle.toon' | translate) : ('quiz.editor.subtitle.graphical' | translate) }}
      </p>
    </div>
    <div class="header-right">
      <a
        class="btn btn-secondary ghost"
        routerLink="/quiz/ai-quiz-generator"
        [class.disabled]="isLoading() || isSaving()">
        ðŸ¤– {{ 'quiz.editor.useAi' | translate }}
      </a>
      <button
        class="btn btn-secondary"
        (click)="toggleEditorMode()"
        [disabled]="isLoading() || isSaving()">
        {{ editorMode() === 'toon' ? ('quiz.editor.switchToGraphical' | translate) : ('quiz.editor.switchToToon' | translate) }}
      </button>
      <button
        class="btn btn-primary"
        (click)="saveQuiz()"
        [disabled]="isLoading() || isSaving() || !unsavedChanges()">
        {{ isSaving() ? ('common.saving' | translate) : ('common.save' | translate) }}
      </button>
      <button
        class="btn btn-secondary"
        (click)="cancel()"
        [disabled]="isSaving()">
        {{ 'common.cancel' | translate }}
      </button>
    </div>
  </div>

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h2>{{ 'errors.loadingFailed' | translate }}</h2>
      <p>{{ error() }}</p>
      <button class="btn btn-primary" (click)="retry()">
        {{ 'common.retry' | translate }}
      </button>
    </div>
  }

  <!-- Co-Author Errors -->
  <div class="error-message co-author-errors" *ngIf="coAuthorErrors().length > 0">
    <strong>{{ 'quiz.editor.coAuthorIssues' | translate }}</strong>
    <ul>
      <li *ngFor="let err of coAuthorErrors()">{{ err }}</li>
    </ul>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading()">
    <div class="spinner"></div>
    <p>{{ 'quiz.editor.loading' | translate }}</p>
  </div>

  <!-- Editor Content -->
  <div class="editor-content" *ngIf="!isLoading() && quiz()">
    <app-toon-editor
      *ngIf="editorMode() === 'toon'"
      [quiz]="quiz()!"
      [questions]="questions()"
      (quizChange)="onQuizUpdate($event)"
      (questionsChange)="questions.set($event); unsavedChanges.set(true)">
    </app-toon-editor>

    <app-graphical-editor
      *ngIf="editorMode() === 'graphical'"
      [quiz]="quiz()!"
      [questions]="questions()"
      [coAuthors]="coAuthors()"
      [isOwner]="isOwner()"
      (quizChange)="onQuizUpdate($event)"
      (questionsChange)="questions.set($event); unsavedChanges.set(true)"
      (coAuthorsChange)="onCoAuthorsChange($event)">
    </app-graphical-editor>
  </div>

  <!-- Unsaved Changes Indicator -->
  <div class="unsaved-indicator" *ngIf="unsavedChanges()">
    <span class="dot"></span>
    {{ 'common.unsavedChanges' | translate }}
  </div>
</div>
