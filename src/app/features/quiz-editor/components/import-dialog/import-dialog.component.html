<div class="import-dialog-overlay" (click)="cancel()">
  <div class="import-dialog" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="dialog-header">
      <h2>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        {{ 'importDialog.title' | translate }}
      </h2>
      <button class="close-btn" (click)="cancel()" [attr.aria-label]="'common.close' | translate">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <!-- Upload Area -->
    @if (!importResult()) {
      <div class="dialog-body">
        <div
          class="upload-area"
          [class.dragging]="isDragging()"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)">

          @if (isProcessing()) {
            <div class="processing">
              <div class="spinner"></div>
              <p>{{ 'importDialog.processing' | translate }}</p>
            </div>
          } @else {
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>

            <h3>{{ 'importDialog.dropzone.title' | translate }}</h3>
            <p class="supported-formats">
              {{ 'importDialog.dropzone.supportedFormats' | translate }}
            </p>

            <input
              type="file"
              id="fileInput"
              accept=".csv,.txt,.apkg"
              (change)="onFileSelected($event)"
              hidden>

            <label for="fileInput" class="btn btn-primary">
              {{ 'importDialog.dropzone.chooseFile' | translate }}
            </label>
          }
        </div>

        <!-- Format Examples -->
        <div class="format-info">
          <h4>{{ 'importDialog.examples.title' | translate }}</h4>

          <div class="format-example">
            <div class="example-header">
              <strong>{{ 'importDialog.examples.csv.title' | translate }}</strong>
              <button class="btn-link" (click)="downloadSampleCsv()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                {{ 'importDialog.examples.downloadSample' | translate }}
              </button>
            </div>
            <code>"Frage","Richtige Antwort","Falsch 1","Falsch 2","Falsch 3"</code>
          </div>

          <div class="format-example">
            <div class="example-header">
              <strong>{{ 'importDialog.examples.ankiTxt.title' | translate }}</strong>
              <button class="btn-link" (click)="downloadSampleAnki()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                {{ 'importDialog.examples.downloadSample' | translate }}
              </button>
            </div>
            <code>Frage[TAB]Antwort</code>
          </div>

          <div class="format-example">
            <div class="example-header">
              <strong>{{ 'importDialog.examples.ankiApkg.title' | translate }}</strong>
              <span class="info-text">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 16v-4M12 8h.01"/>
                </svg>
                {{ 'importDialog.examples.ankiApkg.hint' | translate }}
              </span>
            </div>
            <code>Vollständiges Anki-Paket (.apkg-Datei)</code>
          </div>
        </div>
      </div>
    }

    <!-- Import Result -->
    @if (importResult(); as result) {
      <div class="dialog-body">
        <div class="import-result">
          @if (result.questions.length > 0) {
            <div class="success-message">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
              <h3>{{ (result.questions.length === 1 ? 'importDialog.result.successTitleOne' : 'importDialog.result.successTitleMany') | translate:{ count: result.questions.length } }}</h3>
              <p class="format-detected">{{ (result.format === 'anki-txt' ? 'importDialog.result.formatDetected.ankiTxt' : result.format === 'anki-apkg' ? 'importDialog.result.formatDetected.ankiApkg' : 'importDialog.result.formatDetected.csv') | translate }}</p>
            </div>

            <div class="questions-preview">
              <h4>{{ 'importDialog.result.previewTitle' | translate }}</h4>
              <div class="preview-list">
                @for (q of result.questions.slice(0, 5); track $index) {
                  <div class="preview-item">
                    <div class="question-number">{{ $index + 1 }}</div>
                    <div class="question-content">
                      <strong>{{ q.questionText }}</strong>
                      <span class="answer">✓ {{ q.correctAnswer }}</span>
                    </div>
                  </div>
                }
                @if (result.questions.length > 5) {
                  <p class="more-questions">
                    {{ (result.questions.length - 5 === 1 ? 'importDialog.result.moreOne' : 'importDialog.result.moreMany') | translate:{ count: (result.questions.length - 5) } }}
                  </p>
                }
              </div>
            </div>

            @if (result.errors.length > 0) {
              <div class="warnings">
                <h4>{{ 'importDialog.result.warningsTitle' | translate:{ count: result.errors.length } }}</h4>
                <ul>
                  @for (error of result.errors.slice(0, 5); track $index) {
                    <li>{{ error }}</li>
                  }
                  @if (result.errors.length > 5) {
                    <li>{{ 'importDialog.result.moreWarnings' | translate:{ count: (result.errors.length - 5) } }}</li>
                  }
                </ul>
              </div>
            }
          } @else {
            <div class="error-message">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              <h3>{{ 'importDialog.result.failedTitle' | translate }}</h3>
              <ul>
                @for (error of result.errors; track $index) {
                  <li>{{ error }}</li>
                }
              </ul>
            </div>
          }
        </div>
      </div>

      <!-- Actions -->
      <div class="dialog-footer">
        <button class="btn btn-secondary" (click)="cancel()">
          {{ 'common.cancel' | translate }}
        </button>
        @if (result.questions.length > 0) {
          <button class="btn btn-primary" (click)="confirmImport()">
            {{ (result.questions.length === 1 ? 'importDialog.actions.importOne' : 'importDialog.actions.importMany') | translate:{ count: result.questions.length } }}
          </button>
        }
      </div>
    }
  </div>
</div>
