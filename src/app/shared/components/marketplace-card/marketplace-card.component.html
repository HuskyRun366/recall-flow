<a [routerLink]="contentLink()" class="marketplace-card">
  <div class="card-header">
    <div class="type-badge" [class]="'type-' + item().type">
      @switch (item().type) {
        @case ('quiz') {
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
        }
        @case ('deck') {
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="4" width="20" height="16" rx="2"/>
            <line x1="2" y1="10" x2="22" y2="10"/>
          </svg>
        }
        @case ('material') {
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
        }
        @case ('theme') {
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22a10 10 0 1 1 10-10c0 5-4 1-4 6 0 1.1-.9 2-2 2h-4Z"/>
            <circle cx="13.5" cy="6.5" r="1"/>
            <circle cx="17.5" cy="10.5" r="1"/>
            <circle cx="8.5" cy="7.5" r="1"/>
            <circle cx="6.5" cy="12.5" r="1"/>
          </svg>
        }
      }
      <span>{{ typeLabel() | translate }}</span>
    </div>

    @if (themePreviewGradient()) {
      <div class="theme-preview" [style.background]="themePreviewGradient()"></div>
    }
  </div>

  <h3 class="card-title">{{ item().content.title }}</h3>

  @if (item().type === 'theme') {
    <p class="card-description">{{ 'settings.page.theme.marketplace.subtitle' | translate }}</p>
  } @else {
    <p class="card-description">{{ item().content.description }}</p>
  }

  <div class="card-meta">
    @if (categoryLabel()) {
      <span class="meta-badge category">{{ categoryLabel() | translate }}</span>
    }
    @if (difficultyLabel()) {
      <span class="meta-badge difficulty" [class]="difficultyClass()">
        {{ difficultyLabel() | translate }}
      </span>
    }
    @if (languageCode()) {
      <span class="meta-badge language">{{ languageCode() | uppercase }}</span>
    }
  </div>

  <div class="card-rating-row">
    <app-star-rating
      [rating]="item().content.averageRating || 0"
      [count]="item().content.ratingCount || 0"
      size="sm"
    />
  </div>

  <!-- Rating Actions Row -->
  @if (canRate()) {
    <div class="rating-actions">
      <button class="btn-rate" (click)="onRate($event)">
        <span class="icon">‚≠ê</span>
        <span>{{ 'discover.rating.rate' | translate }}</span>
      </button>
    </div>
  }

  <div class="card-stats">
    <div class="stat">
      <span class="stat-value">{{ itemCount() }}</span>
      <span class="stat-label">{{ itemCountLabel() | translate }}</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{ popularityCount() }}</span>
      <span class="stat-label">{{ popularityLabel() | translate }}</span>
    </div>
  </div>

  <div class="card-actions">
    <span class="view-link">{{ 'discover.viewDetails' | translate }}</span>
    <button class="add-btn" (click)="onAdd($event)">
      @if (item().type === 'theme') {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
          <path d="M12 3v12"/>
          <path d="m7 10 5 5 5-5"/>
          <path d="M5 21h14"/>
        </svg>
        {{ 'settings.page.theme.marketplace.install' | translate }}
      } @else {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        {{ 'common.add' | translate }}
      }
    </button>
  </div>
</a>
