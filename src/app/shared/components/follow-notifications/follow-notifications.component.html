<div class="follow-notifications">
  <button
    class="notification-trigger"
    (click)="toggleDropdown()"
    [attr.aria-label]="'followNotifications.title' | translate"
    [attr.aria-expanded]="dropdownOpen()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
    </svg>
    @if (unreadCount() > 0) {
      <span class="badge">{{ unreadCount() > 9 ? '9+' : unreadCount() }}</span>
    }
  </button>

  @if (dropdownOpen()) {
    <div class="dropdown-backdrop" (click)="closeDropdown()"></div>
  }

  <div class="dropdown" [class.open]="dropdownOpen()" cdkTrapFocus [cdkTrapFocusAutoCapture]="dropdownOpen()">
    <div class="dropdown-header">
      <h3>{{ 'followNotifications.title' | translate }}</h3>
      @if (notifications().length > 0) {
        <div class="header-actions">
          @if (unreadCount() > 0) {
            <button class="action-btn" (click)="markAllAsRead()" [title]="'followNotifications.markAllRead' | translate">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
          }
          <button class="action-btn" (click)="clearAll()" [title]="'followNotifications.clearAll' | translate">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
              <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
          </button>
        </div>
      }
    </div>

    <div class="dropdown-content">
      @if (isLoading()) {
        <div class="loading-state">
          <div class="spinner"></div>
        </div>
      } @else if (notifications().length === 0) {
        <div class="empty-state">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <p>{{ 'followNotifications.empty' | translate }}</p>
        </div>
      } @else {
        <div class="notifications-list">
          @for (notification of notifications(); track notification.id) {
            <a
              [routerLink]="getContentRoute(notification)"
              class="notification-item"
              [class.unread]="!notification.read"
              (click)="onNotificationClick(notification.id)">
              <div class="notification-avatar">
                @if (notification.authorPhotoURL) {
                  <img [src]="notification.authorPhotoURL" [alt]="notification.authorDisplayName" />
                } @else {
                  <span class="avatar-placeholder">{{ notification.authorDisplayName.charAt(0) }}</span>
                }
              </div>
              <div class="notification-content">
                <p class="notification-text">
                  <strong>{{ notification.authorDisplayName }}</strong>
                  {{ getNotificationTextKey(notification) | translate }}
                </p>
                <p class="notification-quiz">{{ notification.contentTitle }}</p>
                <span class="notification-time">{{ formatTimeAgo(notification.createdAt) }}</span>
              </div>
              <button
                class="delete-btn"
                (click)="deleteNotification($event, notification.id)"
                [title]="'common.delete' | translate">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </a>
          }
        </div>
      }
    </div>
  </div>
</div>
